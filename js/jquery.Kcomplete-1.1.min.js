!(function(a){a.fn.Kcomplete=function(i){a(this).parent().append('<div class="K_complete"><ul></ul></div>');a(this).parent().find(".K_complete").width(a(this).outerWidth(true)-2);var e=a(this);var d=0;var j=a(this).siblings(".K_complete");var c,b,g;var i=a.extend({},a.fn.Kcomplete.defaults,i);j.bind("boxClose",function(){a(this).hide().find("ul").html("")});function h(m){switch(m){case 40:d=d<c?d+1:1;j.find("li").removeAttr("class").eq(parseInt(d-1)).addClass("active");var l=j.find("li").eq(parseInt(d-1)).text();e.val(l);if(i.selectCount=="scrollbar"){d>i.scrollBarCount?j.scrollTop(j.scrollTop()+parseInt(i.liHeight)):j.scrollTop(0)}break;case 38:d<=1?d=c:d=d-1;j.find("li").removeAttr("class").eq(parseInt(d-1)).addClass("active");var l=j.find("li").eq(parseInt(d-1)).text();e.val(l);if(i.selectCount=="scrollbar"){if((d<c)&&((c-d+1)>i.scrollBarCount)){j.scrollTop(j.scrollTop()-parseInt(i.liHeight))}else{j.scrollTop(c*parseInt(i.liHeight))}}break;case 13:j.trigger("boxClose");break}}e.keyup(function(k){var l=k.which;if(l==38||l==40||l==13){h(l)}else{a.get(i.location,{input:e.val()},function(m){if(i.dataType=="xml"){var n=a(m).find(e.val()).find("data")}else{if(i.dataType=="json"){n=a(m)}}f(n);if(a.trim(e.val()).length&&n.length>0){d=0;j.show();}else{j.trigger("boxClose")}},i.dataType)}});function f(k){var n=e.offset().left;var m=e.offset().top+parseInt(i.liHeight);g="";k.each(function(o){if(this.value.length>0){if(a(this).text().length==0){b=this.value}else{b=a(this).text()}if((a.isNumeric(i.selectCount)&&(o<i.selectCount))||i.selectCount.length>0){g+="<li>"+b+"</li>"}}});j.find("ul").html(g);j.css({"left":n,"top":m});j.find("li").css({"height":i.liHeight,"line-height":i.liHeight});c=j.find("li").size();if(i.selectCount=="scrollbar"){if(c<i.scrollBarCount){var l=c*parseInt(i.liHeight)}else{var l=i.scrollBarCount*parseInt(i.liHeight)}j.css({"height":l,"overflow":"auto"})}}j.on("click","li",function(){e.val(a(this).text());j.trigger("boxClose");e.trigger('change')});a(document).bind("click",function(l){var k=a(l.target);if(k.closest("."+j.attr("class")).length==0){j.trigger("boxClose")}})};a.fn.Kcomplete.version="1.1";a.fn.Kcomplete.defaults={dataType:"json",location:"",liHeight:"22px",selectCount:"scrollbar",scrollBarCount:4}})(jQuery);
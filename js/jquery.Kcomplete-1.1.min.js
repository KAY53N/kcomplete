/*
 *  author:		xujiantao - http://www.xujiantao.com
 *
 *	version:	Kcomplete 1.1 - 2013-12-03
 */
!function(a){a.fn.Kcomplete=function(b){function i(a){var g;switch(a){case 40:d=f>d?d+1:1,e.find("li").removeAttr("class").eq(parseInt(d-1)).addClass("active"),g=e.find("li").eq(parseInt(d-1)).text(),c.val(g),"scrollbar"==b.selectCount&&(d>b.scrollBarCount?e.scrollTop(e.scrollTop()+parseInt(b.liHeight)):e.scrollTop(0));break;case 38:1>=d?d=f:d-=1,e.find("li").removeAttr("class").eq(parseInt(d-1)).addClass("active"),g=e.find("li").eq(parseInt(d-1)).text(),c.val(g),"scrollbar"==b.selectCount&&(f>d&&f-d+1>b.scrollBarCount?e.scrollTop(e.scrollTop()-parseInt(b.liHeight)):e.scrollTop(f*parseInt(b.liHeight)));break;case 13:e.trigger("boxClose")}}function j(d){var k,i=c.offset().left,j=c.offset().top+parseInt(b.liHeight);h="",d.each(function(c){this.value.length>0&&(g=0==a(this).text().length?this.value:a(this).text(),(a.isNumeric(b.selectCount)&&c<b.selectCount||b.selectCount.length>0)&&(h+="<li>"+g+"</li>"))}),e.find("ul").html(h),e.css({left:i,top:j}),e.find("li").css({height:b.liHeight,"line-height":b.liHeight}),f=e.find("li").size(),"scrollbar"==b.selectCount&&(k=f<b.scrollBarCount?f*parseInt(b.liHeight):b.scrollBarCount*parseInt(b.liHeight),e.css({height:k,overflow:"auto"}))}var c,d,e,f,g,h;a(this).parent().append('<div class="K_complete"><ul></ul></div>'),a(this).parent().find(".K_complete").width(a(this).outerWidth(!0)-2),c=a(this),d=0,e=a(".K_complete"),b=a.extend({},a.fn.Kcomplete.defaults,b),e.bind("boxClose",function(){a(this).hide().find("ul").html("")}),c.keyup(function(f){var g=f.which;38==g||40==g||13==g?i(g):a.get(b.location,{input:c.val()},function(f){if("xml"==b.dataType)var g=a(f).find(c.val()).find("data");else"json"==b.dataType&&(g=a(f));j(g),a.trim(c.val()).length&&g.length>0?(d=0,e.show()):e.trigger("boxClose")},b.dataType)}),a(".K_complete li").live("click",function(){c.val(a(this).text()),e.trigger("boxClose")}),a(document).bind("click",function(b){var c=a(b.target);0==c.closest("."+e.attr("class")).length&&e.trigger("boxClose")})},a.fn.Kcomplete.version="1.1",a.fn.Kcomplete.defaults={dataType:"json",location:"",liHeight:"22px",selectCount:"scrollbar",scrollBarCount:4}}(jQuery);